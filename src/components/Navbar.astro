---
// src/components/Navbar.astro
---
<!-- BARRA SUPERIOR (Navbar) -->
<nav class="fixed w-full z-50 top-0 bg-black/90 backdrop-blur-md border-b border-white/10">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center relative z-50">

        <!-- LOGO -->
        <a href="/" class="text-2xl font-bold tracking-[0.2em] text-white hover:text-red-600 transition duration-500 font-serif">
            MAL ESP√çRITU
        </a>

        <!-- MEN√ö ESCRITORIO -->
        <ul class="hidden md:flex gap-8 text-xs uppercase tracking-widest text-gray-400 font-sans">
            <li><a href="/" class="hover:text-white transition hover:underline decoration-red-800 decoration-2 underline-offset-4">Inicio</a></li>
            <li><a href="/relatos" class="hover:text-white transition hover:underline decoration-red-800 decoration-2 underline-offset-4">Relatos</a></li>
            <li><a href="/#buzon" class="hover:text-white transition hover:underline decoration-red-800 decoration-2 underline-offset-4">Confesar Historia</a></li>
        </ul>

        <!-- ZONA DERECHA: AUDIO + MEN√ö M√ìVIL -->
        <div class="flex items-center gap-5">

            <!-- üîä BOT√ìN DE AUDIO -->
            <button id="audio-btn" class="text-gray-400 hover:text-red-500 transition focus:outline-none group" aria-label="Activar sonido ambiente">
                <!-- Icono MUTE (Visible por defecto) -->
                <svg id="icon-mute" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 5L6 9H2v6h4l5 4V5z"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>

                <!-- Icono SONIDO (Oculto) -->
                <svg id="icon-sound" class="hidden animate-pulse text-red-600" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
            </button>

            <!-- ARCHIVO DE AUDIO LOCAL -->
            <!-- Aqu√≠ conectamos tu archivo mp3 -->
            <audio id="bg-music" loop>
                <source src="/audio/ambiente.mp3" type="audio/mpeg">
            </audio>

            <!-- BOT√ìN HAMBURGUESA (M√ìVIL) -->
            <button id="menu-btn" class="md:hidden text-white focus:outline-none group relative z-50">
                <div class="w-6 h-6 flex flex-col justify-center items-end gap-1.5">
                    <span id="line-1" class="bg-white h-0.5 w-full transition-all duration-300 group-hover:bg-red-500"></span>
                    <span id="line-2" class="bg-white h-0.5 w-2/3 transition-all duration-300 group-hover:w-full group-hover:bg-red-500"></span>
                    <span id="line-3" class="bg-white h-0.5 w-full transition-all duration-300 group-hover:bg-red-500"></span>
                </div>
            </button>
        </div>

    </div>

    <!-- MEN√ö M√ìVIL -->
    <div id="mobile-menu" class="fixed inset-0 bg-black z-[999] flex flex-col justify-center items-center translate-x-full transition-transform duration-300 ease-in-out md:hidden h-screen w-screen">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-red-900/20 via-black to-black pointer-events-none"></div>

        <ul class="flex flex-col gap-10 text-center z-10 relative">
            <li><a href="/" class="mobile-link text-4xl font-serif text-white hover:text-red-600 transition block py-2">Inicio</a></li>
            <li><a href="/relatos" class="mobile-link text-4xl font-serif text-white hover:text-red-600 transition block py-2">Relatos</a></li>
            <li><a href="/#buzon" class="mobile-link text-4xl font-serif text-white hover:text-red-600 transition block py-2">Confesar Historia</a></li>
        </ul>
        <p class="absolute bottom-10 text-neutral-600 text-xs tracking-widest">¬© Mal Esp√≠ritu</p>
    </div>
</nav>

<script>
    document.addEventListener('astro:page-load', () => {
        // --- MEN√ö M√ìVIL ---
        const btn = document.getElementById('menu-btn');
        const menu = document.getElementById('mobile-menu');
        const links = document.querySelectorAll('.mobile-link');
        const line1 = document.getElementById('line-1');
        const line2 = document.getElementById('line-2');
        const line3 = document.getElementById('line-3');

        let isMenuOpen = false;

        function toggleMenu() {
            isMenuOpen = !isMenuOpen;
            if (isMenuOpen) {
                menu?.classList.remove('translate-x-full');
                line1?.classList.add('rotate-45', 'translate-y-2', 'bg-red-500');
                line2?.classList.add('opacity-0');
                line3?.classList.add('-rotate-45', '-translate-y-2', 'bg-red-500');
                document.body.style.overflow = 'hidden';
            } else {
                menu?.classList.add('translate-x-full');
                line1?.classList.remove('rotate-45', 'translate-y-2', 'bg-red-500');
                line2?.classList.remove('opacity-0');
                line3?.classList.remove('-rotate-45', '-translate-y-2', 'bg-red-500');
                document.body.style.overflow = '';
            }
        }

        if(btn) btn.addEventListener('click', toggleMenu);
        links.forEach(link => {
            link.addEventListener('click', () => { if(isMenuOpen) toggleMenu(); });
        });

        // --- L√ìGICA DE AUDIO ---
        const audioBtn = document.getElementById('audio-btn');
        const bgMusic = document.getElementById('bg-music') as HTMLAudioElement | null;
        const iconMute = document.getElementById('icon-mute');
        const iconSound = document.getElementById('icon-sound');

        if(audioBtn && bgMusic) {
            bgMusic.volume = 0.4; // Volumen al 40%

            audioBtn.addEventListener('click', async () => {
                if (bgMusic.paused) {
                    try {
                        await bgMusic.play();
                        iconMute?.classList.add('hidden');
                        iconSound?.classList.remove('hidden');
                        audioBtn.classList.add('text-red-500', 'scale-110');
                    } catch (err) {
                        console.error("Error de reproducci√≥n:", err);
                    }
                } else {
                    bgMusic.pause();
                    iconMute?.classList.remove('hidden');
                    iconSound?.classList.add('hidden');
                    audioBtn.classList.remove('text-red-500', 'scale-110');
                }
            });
        }
    });
</script>
